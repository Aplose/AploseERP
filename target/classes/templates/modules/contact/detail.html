<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/base}">
<head><title th:text="${contact.fullName}">Contact</title></head>
<body>
<div layout:fragment="content">

    <!-- Header -->
    <div class="d-flex align-items-start justify-content-between mb-4">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item"><a th:href="@{/contacts}">Contacts</a></li>
                    <li th:if="${contact.thirdPartyLinks != null and !contact.thirdPartyLinks.isEmpty()}"
                        class="breadcrumb-item">
                        <a th:href="@{/third-parties/{id}(id=${contact.thirdPartyLinks[0].thirdParty.id})}"
                           th:text="${contact.thirdPartyLinks[0].thirdParty.name}">Company</a>
                    </li>
                    <li class="breadcrumb-item active" th:text="${contact.fullName}">Contact</li>
                </ol>
            </nav>
            <h4 class="mb-1" th:text="${contact.fullName}">Name</h4>
            <div>
                <span th:if="${contact.jobTitle}" class="text-muted me-2" th:text="${contact.jobTitle}"></span>
                <span th:if="${contact.primary}" class="badge bg-success me-1">Primary</span>
                <span class="badge"
                      th:classappend="${contact.status == 'ACTIVE'} ? 'bg-success' : 'bg-secondary'"
                      th:text="${contact.status}">ACTIVE</span>
            </div>
        </div>
        <div class="d-flex gap-2">
            <a th:href="@{/contacts/{id}/edit(id=${contact.id})}"
               class="btn btn-outline-primary btn-sm"
               sec:authorize="hasAuthority('CONTACT_UPDATE')">
                <i class="bi bi-pencil me-1"></i>Edit
            </a>
            <form th:action="@{/contacts/{id}/delete(id=${contact.id})}" method="post"
                  sec:authorize="hasAuthority('CONTACT_DELETE')"
                  onsubmit="return confirm('Delete this contact?')">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-trash me-1"></i>Delete
                </button>
            </form>
        </div>
    </div>

    <div class="row g-4">

        <!-- Info -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent fw-semibold">
                    <i class="bi bi-person me-2 text-primary"></i>Information
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4 text-muted fw-normal" th:text="#{contact.thirdPartyLinks}">Third Parties</dt>
                        <dd class="col-sm-8">
                            <ul class="list-unstyled mb-0" th:if="${contact.thirdPartyLinks != null and !contact.thirdPartyLinks.isEmpty()}">
                                <li th:each="link : ${contact.thirdPartyLinks}" class="mb-1">
                                    <a th:href="@{/third-parties/{id}(id=${link.thirdParty.id})}"
                                       th:text="${link.thirdParty.name}" class="text-decoration-none"></a>
                                    <span class="text-muted small" th:if="${link.linkTypeCode}"
                                          th:text="' (' + (linkTypeLabels != null and linkTypeLabels[link.linkTypeCode] != null ? linkTypeLabels[link.linkTypeCode] : link.linkTypeCode) + ')'"> (Salarié)</span>
                                </li>
                            </ul>
                            <span th:unless="${contact.thirdPartyLinks != null and !contact.thirdPartyLinks.isEmpty()}" class="text-muted">—</span>
                        </dd>

                        <dt class="col-sm-4 text-muted fw-normal">Department</dt>
                        <dd class="col-sm-8" th:text="${contact.department ?: '—'}">—</dd>

                        <dt class="col-sm-4 text-muted fw-normal">Email</dt>
                        <dd class="col-sm-8">
                            <a th:if="${contact.email}" th:href="'mailto:' + ${contact.email}"
                               th:text="${contact.email}"></a>
                            <span th:unless="${contact.email}">—</span>
                        </dd>

                        <dt class="col-sm-4 text-muted fw-normal">Email (2nd)</dt>
                        <dd class="col-sm-8">
                            <a th:if="${contact.emailSecondary}"
                               th:href="'mailto:' + ${contact.emailSecondary}"
                               th:text="${contact.emailSecondary}"></a>
                            <span th:unless="${contact.emailSecondary}">—</span>
                        </dd>

                        <dt class="col-sm-4 text-muted fw-normal">Phone</dt>
                        <dd class="col-sm-8" th:text="${contact.phone ?: '—'}">—</dd>

                        <dt class="col-sm-4 text-muted fw-normal">Mobile</dt>
                        <dd class="col-sm-8" th:text="${contact.phoneMobile ?: '—'}">—</dd>

                        <dt class="col-sm-4 text-muted fw-normal">Fax</dt>
                        <dd class="col-sm-8" th:text="${contact.fax ?: '—'}">—</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Address -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent fw-semibold">
                    <i class="bi bi-geo-alt me-2 text-primary"></i>Address
                </div>
                <div class="card-body">
                    <address class="mb-0">
                        <span th:if="${contact.addressLine1}" th:text="${contact.addressLine1}"></span>
                        <br th:if="${contact.addressLine1}"/>
                        <span th:if="${contact.addressLine2}" th:text="${contact.addressLine2}"></span>
                        <br th:if="${contact.addressLine2}"/>
                        <span th:if="${contact.postalCode}" th:text="${contact.postalCode + ' '}"></span>
                        <span th:if="${contact.city}" th:text="${contact.city}"></span>
                        <br th:if="${contact.city || contact.postalCode}"/>
                        <span th:if="${contact.stateProvince}" th:text="${contact.stateProvince}"></span>
                        <br th:if="${contact.stateProvince}"/>
                        <strong th:if="${contact.countryCode}" th:text="${contact.countryCode}"></strong>
                        <span th:unless="${contact.addressLine1 || contact.city || contact.countryCode}"
                              class="text-muted">No address on file</span>
                    </address>
                </div>
            </div>
        </div>

        <!-- Notes -->
        <div class="col-12" th:if="${contact.notes}">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent fw-semibold">
                    <i class="bi bi-chat-text me-2 text-primary"></i>Notes
                </div>
                <div class="card-body">
                    <p class="mb-0" th:text="${contact.notes}"></p>
                </div>
            </div>
        </div>

        <!-- Extra fields (detail) -->
        <div class="col-12" th:if="${extraFieldDefinitionsDetail != null and !#lists.isEmpty(extraFieldDefinitionsDetail)}">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent fw-semibold">
                    <i class="bi bi-sliders me-2 text-primary"></i>
                    <span th:text="#{extrafield.title}">Champs complémentaires</span>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <th:block th:each="def : ${extraFieldDefinitionsDetail}">
                            <dt class="col-sm-4 text-muted fw-normal" th:text="${def.label}">Label</dt>
                            <dd class="col-sm-8" th:text="${extraFieldValues != null and extraFieldValues[def.fieldCode] != null and !#strings.isEmpty(extraFieldValues[def.fieldCode])} ? ${extraFieldValues[def.fieldCode]} : '—'">—</dd>
                        </th:block>
                    </dl>
                </div>
            </div>
        </div>

    </div>

</div>
</body>
</html>
